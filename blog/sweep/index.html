<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <!--  google adsense -->
  <script data-ad-client="ca-pub-1054696837285307" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <title>Jerry&#39;s DevLog</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">
  <meta name="author" content="Jerry Kim">
  <meta name="generator" content="Hugo 0.54.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://jjerry-k.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://jjerry-k.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://jjerry-k.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://jjerry-k.github.io/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://jjerry-k.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://jjerry-k.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://jjerry-k.github.io/images/favicon.png " type="image/x-icon">

  
  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-126636477-1', 'auto');
    ga('send', 'pageview');
  </script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
</head><body>
<!-- preloader start -->
<div class="preloader">
  
  <img src="https://jjerry-k.github.io/images/preloader.gif " alt="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://jjerry-k.github.io"><img class="img-fluid"
          src="https://jjerry-k.github.io/images/logo.png" alt="Jerry&#39;s DevLog"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/jerry.kim.566/"><i class="ti-facebook"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/jjerry_k"><i class="ti-twitter-alt"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.instagram.com/jjjerry_k/"><i class="ti-instagram"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/jjerry-k"><i class="ti-github"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/jerry-kim-b8804216b/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://jjerry-k.github.io"><img class="img-fluid"
            src="https://jjerry-k.github.io/images/logo.png" alt="Jerry&#39;s DevLog"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://jjerry-k.github.io/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://jjerry-k.github.io/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://jjerry-k.github.io/contact">Contact</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://jjerry-k.github.io/search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/deeplearning"
          class="text-primary">Deep learning</a>
        
        <h2>Weights &amp; Biases Usage - [2]</h2>
        <div class="mb-3 post-meta">
          <span>By Jerry Kim</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>28 August 2020</span>
          
        </div>
        
        <img src="https://assets.website-files.com/5ac6b7f2924c656f2b13a88c/5e54ccdeb845e49a782c6cfd_wandb-logo.svg" class="img-fluid w-100 mb-4" alt="Weights &amp; Biases Usage - [2]">
        
        <div class="content mb-5">
          

<p>오늘은 Weights &amp; Biases 의 기능중 하나인 <code>sweep</code>에 대해서 알아보려고 합니다.</p>

<p><code>sweep</code>은 정말 쉽게 말해서 <strong>Hyper parameter search and model optimization</strong> 을 쉽게 할 수 있도록 해주는 기능입니다.</p>

<p>자세한 장단점에 대해서 궁금하신 분은 <a href="https://docs.wandb.com/sweeps">여기</a>를 눌러서 확인해주세요!</p>

<p>그럼 사용법을 알아보겠습니다.</p>

<h3 id="1-학습-스크립트-작성">1. 학습 스크립트 작성.</h3>

<ul>
<li><code>model.py</code>와 <code>train.py</code> 이렇게 두 개의 스크립트를 작성했습니다.</li>
</ul>

<pre><code class="language-python"># model.py
import tensorflow as tf
from tensorflow.keras import models, layers, losses, optimizers
from tensorflow.keras.applications import DenseNet121, DenseNet169, DenseNet201
from tensorflow.keras.applications import VGG16, VGG19, Xception, InceptionResNetV2, InceptionV3
from tensorflow.keras.applications import MobileNet, MobileNetV2, NASNetLarge, NASNetMobile
from tensorflow.keras.applications import ResNet50, ResNet101, ResNet152, ResNet50V2, ResNet101V2, ResNet152V2

model_dict = {
    &quot;vgg16&quot;: VGG16, 
    &quot;vgg19&quot;: VGG19,
    &quot;resnet50&quot;: ResNet50,
    &quot;resnet101&quot;: ResNet101,
    &quot;resnet152&quot;: ResNet152,
    &quot;resnet50v2&quot;: ResNet50V2,
    &quot;resnet101v2&quot;: ResNet101V2,
    &quot;resnet152v2&quot;: ResNet152V2,
    &quot;densenet121&quot;: DenseNet121,
    &quot;densenet169&quot;: DenseNet169,
    &quot;densenet201&quot;: DenseNet201,
    &quot;mobilenet&quot;: MobileNet,
    &quot;mobilenetv2&quot;: MobileNetV2,
    &quot;xception&quot;: Xception,
    &quot;inceptionresnetv2&quot;: InceptionResNetV2,
    &quot;inceptionv3&quot;: InceptionV3, 
    &quot;nasnetlarge&quot;: NASNetLarge,
    &quot;nasnetmobile&quot;: NASNetMobile    
}

def build_model(config, num_classes=10, name=&quot;model&quot;):
    assert config.model_name.lower() in model_dict.keys(), f&quot;Please, check pretrained model list {list(model_dict.keys())}&quot;

    last_activation = &quot;softmax&quot; if num_classes &gt; 1 else &quot;sigmoid&quot;

    
    base_model = model_dict[config.model_name.lower()](include_top=False, weights=&quot;imagenet&quot;, pooling=&quot;avg&quot;)

    if config.freeze:
        base_model.trainable = False
    
    output = layers.Dropout(config.dropout, name=f&quot;{name}_dropout&quot;)(base_model.output)
    output = layers.Dense(num_classes, last_activation, name=f&quot;{name}_output&quot;)(output)

    model = models.Model(base_model.input, output, name=name)
    return model
</code></pre>

<pre><code class="language-python">#train.py
import os
import cv2 as cv
import numpy as np
import tensorflow as tf
from tensorflow.keras import optimizers, utils

from model import *

import wandb
from wandb.keras import WandbCallback

tf.random.set_seed(42)

hyperparameter_defaults = dict(
model_name=&quot;mobilenet&quot;,
dropout = 0.5,
freeze = 1,
batch_size = 128,
learning_rate = 0.001,
epochs = 5,
GPUs=&quot;0&quot;
)

wandb.init(project=&quot;usage_02&quot;, config=hyperparameter_defaults)
config = wandb.config

os.environ[&quot;CUDA_DEVICE_ORDER&quot;]=&quot;PCI_BUS_ID&quot;
os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;]=config.GPUs

# For Efficiency
gpus = tf.config.experimental.list_physical_devices('GPU')
if gpus:
    try:
        for gpu in gpus:
            tf.config.experimental.set_memory_growth(gpu, True)
        logical_gpus = tf.config.experimental.list_logical_devices('GPU')
        print(len(gpus), &quot;Physical GPUs,&quot;, len(logical_gpus), &quot;Logical GPUs&quot;)
    except RuntimeError as e:
        print(e)

# Data Prepare

URL = 'https://storage.googleapis.com/download.tensorflow.org/example_images/flower_photos.tgz'
path_to_zip  = tf.keras.utils.get_file('flower_photos.tgz', origin=URL, extract=True)

PATH = os.path.join(os.path.dirname(path_to_zip), 'flower_photos')

category_list = [i for i in os.listdir(PATH) if os.path.isdir(os.path.join(PATH, i)) ]
print(category_list)

num_classes = len(category_list)
img_size = 128

def read_img(path, img_size):
    img = cv.imread(path)
    img = cv.cvtColor(img, cv.COLOR_BGR2RGB)
    img = cv.resize(img, (img_size, img_size))
    return img

imgs_tr = []
labs_tr = []

imgs_val = []
labs_val = []

for i, category in enumerate(category_list):
    path = os.path.join(PATH, category)
    imgs_list = os.listdir(path)
    print(&quot;Total '%s' images : %d&quot;%(category, len(imgs_list)))
    ratio = int(np.round(0.05 * len(imgs_list)))
    print(&quot;%s Images for Training : %d&quot;%(category, len(imgs_list[ratio:])))
    print(&quot;%s Images for Validation : %d&quot;%(category, len(imgs_list[:ratio])))
    print(&quot;=============================&quot;)

    imgs = [read_img(os.path.join(path, img),img_size) for img in imgs_list]
    labs = [i]*len(imgs_list)

    imgs_tr += imgs[ratio:]
    labs_tr += labs[ratio:]
    
    imgs_val += imgs[:ratio]
    labs_val += labs[:ratio]

imgs_tr = np.array(imgs_tr)/255.
labs_tr = utils.to_categorical(np.array(labs_tr), num_classes)

imgs_val = np.array(imgs_val)/255.
labs_val = utils.to_categorical(np.array(labs_val), num_classes)

print(imgs_tr.shape, labs_tr.shape)
print(imgs_val.shape, labs_val.shape)

# Build Network
strategy = tf.distribute.MirroredStrategy()

with strategy.scope():
    model = build_model(config, num_classes)
    loss = 'binary_crossentropy' if num_classes==1 else 'categorical_crossentropy'
    model.compile(optimizer=optimizers.Adam(config.learning_rate), loss=loss, metrics=['acc'])

# Training Network

model.fit(x=imgs_tr, y=labs_tr, batch_size=config.batch_size, epochs=config.epochs, 
            callbacks = [WandbCallback()], 
            validation_data=(imgs_val, labs_val))
</code></pre>

<h3 id="2-기본-값으로-학습-진행">2. 기본 값으로 학습 진행.</h3>

<pre><code class="language-python">python train.py
</code></pre>

<p>그 후에 Weights &amp; Biases 로 가보면 다음과 같이 프로젝트가 만들어진 것을 확인 할 수 있습니다.</p>

<figure>
    <img src="/images/post/sweep/Untitled.png"/> 
</figure>


<h3 id="3-sweep-configuration">3. sweep configuration</h3>

<p>프로젝트 창에서 왼쪽에 <strong>빗자루 모양 아이콘</strong>을 누른 후에 오른쪽 상단에 <strong>Create sweep</strong> 를 눌러줍니다. ****</p>

<figure>
    <img src="/images/post/sweep/Untitled_1.png"/> 
</figure>


<p>그러면 다음과 같은 창이 나오는데요. 이제 hyper parameter search를 어떻게 할건지 세팅하는 단계입니다.</p>

<figure>
    <img src="/images/post/sweep/Untitled_2.png"/> 
</figure>


<p>저는 다음과 같이 세팅을 했습니다.</p>

<p>이렇게 하면 grid search&hellip;니까&hellip;.</p>

<p>2 * 5 * 3 * 2 * 3 = 180 개의 결과가 나오겠군요&hellip;</p>

<pre><code class="language-yaml">program: train.py
method: grid
metric:
  name: loss
  goal: minimize
parameters:
  GPUs:
    value: &quot;0&quot;
  epochs:
    value: 10
  freeze:
    values: [0, 1]
  dropout:
    values: [0.1, 0.2, 0.4, 0.5, 0.7]
  batch_size:
    values: [64, 128, 256]
  model_name:
    values: [mobilenet, mobilenetv2]
  learning_rate:
    values: [0.001, 0.005, 0.0005]
</code></pre>

<p>그리고 Initialize Sweep 를 눌러줍니다! 그러면 다음과 같은 화면이 나올거에요!</p>

<figure>
    <img src="/images/post/sweep/Untitled_3.png"/> 
</figure>


<h3 id="4-sweep-실행">4. Sweep 실행</h3>

<p>가운데에 적혀있는 커맨드를 터미널에서 실행시켜줍니다!</p>

<pre><code class="language-bash">wandb agent {sweep-id}
</code></pre>

<p>그러면 터미널에 wandb: Starting wandb agent 🕵️ 이런 문구와 함께 세팅대로 Network를 학습하게 됩니다!</p>

<p>이제 잠시 티타임을&hellip;가집니다.. (잠깐이 아닐 수도 있음..)</p>

<figure>
    <img src="/images/post/sweep/Untitled_4.png"/> 
</figure>


<h3 id="5-결과-확인">5. 결과 확인</h3>

<p>Weights &amp; Biases 화면에서 <strong>View Sweep</strong> 을 눌러주세요!</p>

<p>그리고 좌측에 Plot 아이콘을 누르면 다음과 같은 화면이 나옵니다!</p>

<p>원래는 위에 Chart Panel 있는데 접어놨습니다.</p>

<p>이 Panel은 기본적으로 세 개의 그래프로 구성되어 있습니다.</p>

<ul>
<li>각 학습 별 결과 분포도</li>
<li>hyper parameter와 목표 값( 저는 loss ) 간의 중요도, 상관관계</li>
<li>각 학습 별 Parallel graph</li>
</ul>

<figure>
    <img src="/images/post/sweep/Untitled_5.png"/> 
</figure>


<p>이번엔 Hyper parameter tuning을 편하게 할 수 있는 Weighs &amp; Biases의 Sweep에 대해 알아봤습니다.</p>

<p>일일히 값을 변경하지 않고 지정해 놓으면 알아서 진행을 할테니..사용자는 좀 쉴&hellip;&hellip;수 있겠죠..? (아닐 듯..)</p>

<p>그럼 포스팅을 마치겠습니다! 감사합니다!</p>

<h2 id="p-s">P.S</h2>

<ul>
<li><p>wandb sweep 실행을 background 에서 하는 방법&hellip;?</p>

<pre><code class="language-bash">nohup wandb agent {sweep_id} &gt; nohup.out
</code></pre>

<ul>
<li>이 다음은 뭐 하지&hellip;</li>
</ul></li>
</ul>

        </div>

        
        <div style="text-align:center; margin:20px 0px 20px 0px">
          <a href="https://donaricano.com/mypage/1391188679_guPzXC" target="_blank">
            <img src="https://jjerry-k.github.io/images/promotion.png" alt="donaricano-btn"
            style="height: 100px !important;width: 100px !important;" />
          </br>
            <span class="caption">도움이 되셨다면 몰랑이에게 밀크티를...! </br> 더 다양한 포스팅을 채우도록 노력할게요!</span>
          </a>
        </div>
        
        
        
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'jjerry-k';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://jjerry-k.github.io"><img src="https://jjerry-k.github.io/images/logo.png" alt="Jerry&#39;s DevLog"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contact Me</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="tel:Top%20Secret"><i
                class="ti-mobile mr-3 text-primary"></i>Top Secret</a></li>
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Seoul, Korea of Republic</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:jaeyeol2931@gmail.com"><i
                class="ti-email mr-3 text-primary"></i>jaeyeol2931@gmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://www.facebook.com/jerry.kim.566/">facebook</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://twitter.com/jjerry_k">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.instagram.com/jjjerry_k/">instagram</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://github.com/jjerry-k">github</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/jerry-kim-b8804216b/">linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/blog">Blog</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/deeplearning">Deeplearning</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/living">Living</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/python">Python</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/ubuntu">Ubuntu</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://jjerry-k.github.io/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://jjerry-k.github.io/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://jjerry-k.github.io/contact">Contact</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright &copy; 2020 <a href="https://themefisher.com">Themefisher</a> All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://jjerry-k.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://jjerry-k.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://jjerry-k.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://jjerry-k.github.io/plugins/slick/slick.min.js"></script>

<script src="https://jjerry-k.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://jjerry-k.github.io/plugins/search/fuse.min.js"></script>

<script src="https://jjerry-k.github.io/plugins/search/mark.js"></script>

<script src="https://jjerry-k.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://jjerry-k.github.io/js/script.min.js"></script></body>
</html>